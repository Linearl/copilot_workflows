# 📑 分析工作流程模板

> **版本特点**: 系统化分析 + 数据驱动决策 + 质量可量化

## 📑 快速导航

### 🏗️ 总-分-总工作流结构

- [🎯 阶段一：总体规划（总）](#-阶段一总体规划总) - 步骤1.1-1.6：需求分析→总体计划→环境初始化
- [🔄 阶段二：循环分析（分）](#-阶段二循环分析分) - 步骤2.1：9步分析循环，产出子报告
- [📊 阶段三：汇总报告（总）](#-阶段三汇总报告总) - 步骤3.1-3.3：完成度评估→汇总报告→最终归档

### 📖 详细文档

- [📋 标准流程（总-分-总结构）](#-标准流程总-分-总结构) - 完整流程：阶段一1.1-1.6→阶段二2.1→阶段三3.1-3.3
- [🔄 分析循环](#-分析循环) - 9步核心循环详述
- [📁 目录结构](#-目录结构) - 标准化文件组织
- [💡 分析原则](#-分析原则) - 核心方法论


## 🤖 自动生成区域

> **说明**: 任务专用文档中，AI将自动填充以下内容

### 📝 任务信息

- **项目**: [自动识别项目类型和技术栈]
- **目标**: [用户描述的具体分析需求]
- **关注重点**: [分析重点和成功标准]
- **技术环境**: [技术栈和依赖关系]
- **项目背景**: [可选：记录用户给出的额外信息，如参考源、现有模式/实现方案的描述等]
- 设计意图：[可选，仅当用户目标是重构时需要：用户的设计意图，希望用什么样的设计方案]

---

## 📁 目录结构

```text
analysis_system/
├── analysis_workflow_template.md      # 分析工作流模板
├── analysis_workflow_项目名.md         # 任务专用文档
├── templates/                        # 模板文件
│   ├── master-analysis-plan-template.md # 总体分析计划模板
│   ├── round-plan-template.md        # 轮次分析计划模板
│   ├── analysis-implementation-template.md # 具体实施模板
│   ├── analysis-report-template.md   # 分析报告模板
│   ├── code-review-template.md       # 代码评审模板
│   ├── performance-analysis-template.md # 性能分析模板
│   ├── refactor-plan-template.md     # 重构计划模板
│   ├── overall_refactoring_plan_template.md # 总体重构计划模板
│   ├── detailed_stage_plan_template.md # 详细阶段计划模板
│   └── summary-template.md           # 项目总结模板
├── case-studies/                     # 案例研究目录
│   ├── 项目名-analysis/              # 项目分析案例
│   └── README.md                     # 案例说明
├── tools/                           # 分析工具
│   ├── code-metrics-collector.py    # 代码指标收集器
│   ├── generate-analysis-report.ps1 # 报告生成工具
│   └── analysis-tools-README.md     # 工具说明
└── tasks/
    ├── INDEX.md                      # 全局分析任务索引和进展记录
    ├── workflow_archive/             # 已完成任务的工作流文档存档
    ├── 项目名_分析主题1/                # 【总-分-总】单个分析主题目录
    │   ├── master_plan/              # 【总】总体规划和汇总报告
    │   │   ├── master_analysis_plan.md  # 总体分析计划
    │   │   ├── final_analysis_report.md # 最终汇总报告
    │   │   ├── executive_summary.md     # 管理层执行摘要
    │   │   ├── improvement_roadmap.md   # 改进实施路线图
    │   │   └── analysis_workflow_项目名.md # 工作流文档归档
    │   ├── 1_初始质量评估/             # 【分】第1轮循环分析
    │   │   ├── summary/               # 📋 本轮核心输出文档归档
    │   │   │   ├── round_plan.md          # 轮次分析计划
    │   │   │   ├── round_analysis_report.md # 轮次分析报告
    │   │   │   ├── round_key_findings.md  # 轮次关键发现
    │   │   │   ├── round_recommendations.md # 轮次改进建议
    │   │   │   ├── round_lessons_learned.md # 轮次经验总结
    │   │   │   └── round_summary.md       # 轮次总结记录
    │   │   ├── reports/               # 📊 各类详细分析报告
    │   │   ├── metrics/               # 📈 代码指标和量化数据
    │   │   └── analysis/              # 🔍 详细分析过程和中间结果
    │   ├── 2_性能优化分析/             # 【分】第2轮循环分析（示例，结构同上）
    │   ├── 3_架构重构评估/             # 【分】第3轮循环分析（示例，结构同上）
    │   └── N_具体任务名/               # 【分】第N轮循环分析（示例，结构同上）
    ├── 项目名_分析主题2/                # 另一个独立的分析主题（示例）
    │   ├── master_plan/              # 【总】总体规划和汇总报告
    │   ├── 1_特定功能分析/             # 【分】第1轮循环分析（示例）
    │   ├── 2_集成测试评估/             # 【分】第2轮循环分析（示例）
    │   └── ...                       # 其他轮次（示例）
    └── ...                          # 其他分析主题（示例）
```

### 📁 目录结构详细说明

#### 🏗️ 分析主题目录结构

每个分析主题目录（如 `项目名_分析主题1/`）包含以下子目录：

**📋 master_plan/** - 总体规划和汇总报告目录
- 存放整个分析主题的总体规划和最终汇总报告
- 包含总体分析计划、最终报告、执行摘要等重要文档
- 分析完成后归档工作流文档

**📊 轮次目录（如 `1_初始质量评估/`）** - 单轮分析目录
- 每个轮次目录包含该轮分析的完整输出
- 轮次命名格式：`数字_具体任务名`
- 第一轮必须是 `1_初始质量评估`

#### 🔄 轮次子目录说明

每个轮次目录包含以下四个标准子目录：

**📋 summary/** - 本轮核心输出文档归档
- `round_plan.md` - 轮次分析计划（基于 round-plan-template.md）
- `round_analysis_report.md` - 轮次分析报告（主要输出文档）
- `round_key_findings.md` - 轮次关键发现（重要发现摘要）
- `round_recommendations.md` - 轮次改进建议（具体改进建议）
- `round_lessons_learned.md` - 轮次经验总结（经验教训）
- `round_summary.md` - 轮次总结记录（轮次完成总结）

**📊 reports/** - 各类详细分析报告
- 代码审查报告（代码质量详细分析）
- 性能分析报告（性能瓶颈和优化建议）
- 架构评估报告（架构设计分析）
- 其他专项分析报告（安全、可维护性等）

**📈 metrics/** - 代码指标和量化数据
- 代码复杂度数据（圈复杂度、认知复杂度等）
- 测试覆盖率数据（单元测试、集成测试覆盖率）
- 性能基准数据（执行时间、内存使用等）
- 质量评分数据（代码质量评分、技术债务评估）

**🔍 analysis/** - 详细分析过程和中间结果
- 分析工作笔记（分析过程记录）
- 问题调查过程（问题排查详细过程）
- 测试代码和验证脚本（为验证分析结果编写的代码）
- 临时分析文件（中间分析结果、草稿文档）

#### 💡 目录使用原则

1. **核心文档优先**：重要输出放在 summary/ 目录，便于快速查找
2. **分类存储**：按文档类型分类存储，提高组织性
3. **便于归档**：summary/ 目录的文档是轮次的核心成果，便于最终归档
4. **结构一致**：所有轮次使用相同的目录结构，提高可维护性

---

## 📋 标准流程（总-分-总结构）

> **核心理念**: 先做总体规划（总），然后分步执行循环分析（分），最后生成汇总报告（总）

### 🎯 阶段一：总体规划（总）

#### 步骤1.1：用户描述分析需求

**格式**: "我的[项目类型]项目使用[技术栈]，需要进行[分析类型]分析。希望重点关注[关注点]，分析目标是[具体目标]。"

#### 步骤1.2：AI解析并格式化

AI提取关键信息并生成标准化分析任务描述。

#### 步骤1.3：用户确认信息

必须暂停执行，等待用户手动检查AI解析结果，确认或修正任务信息，这一步骤可能持续多轮（步骤1.2/1.3），直至用户同意进入下一步骤。

#### 步骤1.4：创建专用文档和总体规划

**AI必须执行以下操作**：

```powershell
cd analysis_system
Copy-Item "analysis_workflow_template.md" "analysis_workflow_项目名.md"
```

- **首先进入analysis_system目录**：确保在工作流模板文档所在的正确目录
- 为当前分析任务创建专用的工作流文档
- 文档名应反映具体的分析项目（如：analysis_workflow_anc_host_质量分析.md）
- **更新自动生成区域**：在任务专用文档中填充具体的任务信息
- 暂停执行，提示用户切换到专用工作流文档再继续

#### 步骤1.5：制定总体分析计划

**目标**: 制定完整的分析策略和分步计划

**操作清单**:

- [ ] 分析项目整体架构和规模
- [ ] 确定分析的主要维度（质量、性能、安全、架构等）
- [ ] 制定分阶段分析策略，将大目标分解为可管理的子目标
- [ ] 规划预期的分析轮次和每轮的重点
- [ ] 估算整体分析时间和资源需求
- [ ] 定义成功标准和质量门槛
- [ ] **生成总体分析计划文档**：`master_analysis_plan.md`（使用模板：`templates/master-analysis-plan-template.md`）

**暂停点**: 暂停确认总体计划，征询用户意见和调整建议

#### 步骤1.6：初始化分析环境

**创建分析主题目录**：

```powershell
cd tasks
# 创建workflow_archive目录（如果不存在）
mkdir workflow_archive -ErrorAction SilentlyContinue

# 创建分析主题目录（格式：项目名_分析主题）
$analysisTheme = "项目名_主题名"  # 例如：anc_host_质量分析
mkdir $analysisTheme -ErrorAction SilentlyContinue
cd $analysisTheme

# 创建总体规划目录
mkdir master_plan -ErrorAction SilentlyContinue
Write-Host "已创建分析主题 '$analysisTheme' 和总体规划目录" -ForegroundColor Green
Write-Host "已确保workflow_archive存档目录存在" -ForegroundColor Green
```

**配置分析工具**：

```powershell
# 验证Python环境
python --version
# 安装必要的分析依赖

pip install -r requirements.txt
# 测试工具可用性
python ..\tools\code-metrics-collector.py --help
```

### 🔄 阶段二：循环分析（分）

#### 步骤2.1：执行分析循环

进入**[9步分析循环](#-分析循环)**，每轮生成专门的子报告，重复执行直到总体计划完成或决定进入汇总阶段。

**每轮循环输出**:

- 轮次分析报告（`round_analysis_report.md`）
- 轮次关键发现（`round_key_findings.md`）
- 轮次改进建议（`round_recommendations.md`）
- 轮次经验总结（`round_lessons_learned.md`）
- 轮次数据和指标文件
- 轮次总结记录（`round_summary.md`）

### 📊 阶段三：汇总报告（总）

#### 步骤3.1：评估总体完成度

**评估是否满足以下条件**：

- [ ] 总体分析计划中的主要目标已达成
- [ ] 所有计划的分析维度都已覆盖
- [ ] 发现的问题已有明确的改进计划
- [ ] 各轮次分析结果已形成完整闭环
- [ ] 用户明确表示当前分析已满足需求

**决策标准**：

- **继续分析**：如果总体计划未完成且仍有重要分析价值
- **进入汇总**：如果已获得足够信息可以生成完整的总结报告
- **调整计划**：如果发现原计划需要修正或扩展

#### 步骤3.2：生成汇总分析报告

**目标**: 整合所有轮次的分析结果，生成完整的项目分析报告，并汇总分析经验

**操作清单**:

- [ ] **整合分析结果**: 汇总所有轮次的关键发现
- [ ] **综合问题识别**: 整理项目的主要问题和风险
- [ ] **统一改进建议**: 将各轮建议整合为系统性改进方案
- [ ] **量化评估总结**: 汇总项目的整体质量评分和指标
- [ ] **制定实施路线图**: 提供分阶段的改进实施计划
- [ ] **生成执行摘要**: 为管理层提供简洁的决策支持信息
- [ ] **汇总经验总结**: 整合所有轮次的经验教训和最佳实践
- [ ] **生成分析方法论**: 基于本次分析经验，形成可复用的分析方法和流程改进建议

**输出文档**:

- 📋 `final_analysis_report.md` - 完整的项目分析报告（使用模板：`templates/analysis-report-template.md`）
- 📊 `executive_summary.md` - 管理层执行摘要（使用模板：`templates/summary-template.md`）
- 🎯 `improvement_roadmap.md` - 改进实施路线图（使用模板：`templates/refactor-plan-template.md`）
- 📈 `quality_metrics_summary.md` - 质量指标汇总
- 💡 `analysis_methodology.md` - 分析方法论和经验总结汇总（使用模板：`templates/methodology-template.md`）

#### 步骤3.2.1：重构分析特殊处理（条件触发）

**触发条件**: 当分析目的是重构规划时，额外执行此步骤

**目标**: 为重构项目生成详细的重构实施计划

**判断标准**:

- 分析目标明确提到"重构"、"架构优化"、"模块化改造"等关键词
- 分析结果显示需要进行大规模代码重组
- 用户明确表示需要重构计划

**操作清单**:

- [ ] **评估重构规模**: 基于分析结果评估重构的规模和复杂度
- [ ] **制定重构策略**: 确定渐进式重构还是大规模重构
- [ ] **规划重构阶段**: 将重构工作分解为多个可管理的阶段
- [ ] **评估重构风险**: 识别重构过程中的风险点和应对策略
- [ ] **生成总体重构计划**: 使用 `templates/overall_refactoring_plan_template.md`
- [ ] **生成第一阶段详细计划**: 使用 `templates/detailed_stage_plan_template.md`

**重构计划输出文档**:

- 📋 `overall_refactoring_plan.md` - 总体重构计划（基于 `templates/overall_refactoring_plan_template.md`）
- 🎯 `phase1_detailed_plan.md` - 第一阶段详细实施计划（基于 `templates/detailed_stage_plan_template.md`）
- 📊 `refactoring_risk_assessment.md` - 重构风险评估报告
- 🧪 `refactoring_testing_strategy.md` - 重构测试策略

**重构计划要点**:

- **阶段门控制**: 每个阶段结束后必须通过完整测试验证才能进入下一阶段
- **渐进式实施**: 确保任何时候都不影响系统的核心功能
- **可回滚性**: 每个阶段都要有明确的回滚机制
- **测试优先**: 建立完善的测试体系确保重构安全性

**暂停点**: 重构计划生成后暂停，需要用户审查和确认重构策略

#### 步骤3.3：最终归档和记录

**📁 最终归档要求**:

- 生成汇总报告后完成所有分析轮次的最终归档
- 确保master_plan目录包含总体规划和汇总报告
- 将任务专用工作流文档复制到master_plan目录
- 将任务专用工作流文档移动到workflow_archive目录进行集中存档
- 创建完整的分析档案索引

**📋 归档操作步骤**：

1. **📄 复制工作流文档到master_plan**: 将任务专用工作流文档复制到master_plan目录作为分析档案的一部分
2. **🗂️ 创建workflow_archive目录**: 如果不存在则在tasks目录下创建workflow_archive文件夹
3. **📥 存档工作流文档**: 将任务专用工作流文档移动到tasks/workflow_archive目录进行集中存档
4. **📋 更新INDEX.md**: 更新全局分析任务索引，记录分析完成状态

**归档操作示例**：

```powershell
# 步骤1：复制工作流文档到master_plan目录
Copy-Item "analysis_workflow_项目名.md" "tasks\项目名_分析主题\master_plan\"

# 步骤2：创建workflow_archive目录（如果不存在）
mkdir "tasks\workflow_archive" -ErrorAction SilentlyContinue

# 步骤3：移动工作流文档到存档目录
Move-Item "analysis_workflow_项目名.md" "tasks\workflow_archive\"

# 步骤4：验证归档完成
Write-Host "工作流文档已成功归档到workflow_archive目录" -ForegroundColor Green
```

**📋 INDEX.md更新要求**:

- 分析完全结束后必须更新 `tasks/INDEX.md`
- 记录完整的分析历程、主要发现和最终结论
- 更新分析状态为"已完成"
- 如果 `tasks/INDEX.md`不存在，使用 `templates/INDEX-template.md`创建

```powershell
# 最终归档结构
tasks/
├── INDEX.md                           # 全局分析任务索引
├── workflow_archive/                  # 已完成任务的工作流文档存档
│   ├── analysis_workflow_项目名1.md    # 已完成任务1的工作流文档
│   ├── analysis_workflow_项目名2.md    # 已完成任务2的工作流文档
│   └── ...                           # 其他已完成任务的工作流文档
├── 项目名_分析主题1/                    # 单个分析主题目录
│   ├── master_plan/                   # 【总】总体规划和汇总报告
│   │   ├── master_analysis_plan.md
│   │   ├── final_analysis_report.md
│   │   ├── executive_summary.md
│   │   ├── improvement_roadmap.md
│   │   └── analysis_workflow_项目名.md  # 工作流文档归档副本
│   ├── 1_初始质量评估/                 # 【分】第1轮循环分析
│   ├── 2_性能优化分析/                 # 【分】第2轮循环分析
│   └── N_具体任务名/                   # 【分】第N轮循环分析
├── 项目名_分析主题2/                    # 另一个独立的分析主题
│   ├── master_plan/
│   ├── 1_特定功能分析/
│   └── ...
└── ...                               # 其他分析主题
```

---

## 🔄 分析循环

### 📁 第1步：创建轮次目录结构

**目标**: 为当前轮次创建必要的目录结构

**输入**: 分析主题目录、轮次命名规则
**输出**: 完整的轮次目录结构

**操作清单**:

- [ ] **确定轮次名称**: 第一轮必须是"1_初始质量评估"，后续轮次按"数字_具体任务名"格式命名
- [ ] **创建轮次目录**: 在分析主题目录下创建轮次目录及子目录结构
- [ ] **验证目录结构**: 确保所有必要的子目录都已创建

**创建轮次目录**：

```powershell
# 进入分析主题目录（假设已在tasks/$analysisTheme中）
# 创建轮次目录（格式：数字_具体任务名）
if ($round -eq $null) {
    $round = "1_初始质量评估"  # 第一轮必须是初始质量评估
}
mkdir $round -ErrorAction SilentlyContinue
mkdir $round\summary, $round\reports, $round\metrics, $round\analysis -ErrorAction SilentlyContinue
Write-Host "已创建第 $round 轮分析目录结构" -ForegroundColor Green
```

**📁 轮次目录结构说明**：

- **📋 summary/** - 本轮核心输出文档归档
  - `round_plan.md` - 轮次分析计划
  - `round_analysis_report.md` - 轮次分析报告
  - `round_key_findings.md` - 轮次关键发现
  - `round_recommendations.md` - 轮次改进建议
  - `round_lessons_learned.md` - 轮次经验总结
  - `round_summary.md` - 轮次总结记录

- **📊 reports/** - 各类详细分析报告
  - 代码审查报告
  - 性能分析报告
  - 架构评估报告
  - 其他专项分析报告

- **📈 metrics/** - 代码指标和量化数据
  - 代码复杂度数据
  - 测试覆盖率数据
  - 性能基准数据
  - 质量评分数据

- **🔍 analysis/** - 详细分析过程和中间结果
  - 分析工作笔记
  - 问题调查过程
  - 测试代码和验证脚本
  - 临时分析文件

### 🎯 第2步：制定/更新轮次分析计划

**目标**: 基于总体分析计划，明确本轮分析的具体目标和方法

**输入**: 总体分析计划、上轮分析结果、新发现的问题
**输出**: 本轮次分析计划文档

**操作清单**:

- [ ] **对照总体计划**: 确认本轮在总体计划中的位置和作用
- [ ] **回顾上轮结果**: 分析上轮分析结果和遗留问题
- [ ] **明确本轮范围**: 确定本轮分析的具体范围和深度
- [ ] **选择分析方法**: 选择适合本轮目标的分析工具和方法
- [ ] **制定质量标准**: 设定本轮质量标准和成功指标
- [ ] **估算资源需求**: 估算本轮分析时间和资源需求
- [ ] **识别协助需求**: 识别需要用户协助的数据收集项
- [ ] **生成轮次计划**: 创建 `round_plan.md` 文档（使用模板：`templates/round-plan-template.md`）

### 📊 第3步：收集项目数据

**目标**: 系统性收集项目的基础数据和指标

**输入**: 项目源代码、配置文件、用户提供的补充信息
**输出**: 代码指标报告、依赖关系图、基础数据集

**操作清单**:

- [ ] 运行自动化代码指标收集工具
- [ ] 分析项目结构和模块依赖关系
- [ ] **用户协助**: 询问用户关于性能数据、测试覆盖率等信息
- [ ] **用户协助**: 确认技术栈版本和外部依赖的重要性
- [ ] 记录无法自动获取但对分析重要的信息

**暂停点**: 如遇到需要用户提供的信息，暂停并询问用户

### 🎯 第4步：确定本轮分析内容

**目标**: 基于收集的数据确定本轮具体分析的重点内容

**输入**: 收集到的项目数据、分析计划
**输出**: 本轮分析任务清单

**操作清单**:

- [ ] 分析数据完整性，识别数据缺口
- [ ] 根据数据质量调整分析范围
- [ ] 确定本轮重点分析的模块或功能
- [ ] 识别需要编写测试代码的分析项
- [ ] 制定分析优先级排序

### 🔍 第5步：检查和分析

**目标**: 对项目结构、代码质量等进行深度分析

**输入**: 项目数据、本轮分析任务清单
**输出**: 问题清单、分析报告、发现的模式

**操作清单**:

- [ ] 分析项目架构和模块组织
- [ ] 识别代码异味和反模式
- [ ] 评估代码复杂度和可维护性
- [ ] 检查设计原则和最佳实践遵循情况
- [ ] 分析安全性和潜在风险点
- [ ] 识别性能瓶颈和优化机会

### 📈 第6步：评估和量化（可选测试）

**目标**: 量化分析结果，必要时编写测试代码验证假设

**输入**: 分析报告、问题清单
**输出**: 量化评估报告、测试结果、质量评分

**操作清单**:

- [ ] 计算代码健康度和质量评分
- [ ] 量化技术债务和修复成本
- [ ] **可选**: 编写性能测试代码验证性能问题
- [ ] **可选**: 编写单元测试验证代码行为
- [ ] **可选**: 创建重构验证测试
- [ ] 建立质量基线和趋势分析

**暂停点**: 如需编写测试代码，可暂停询问用户是否需要

### 📝 第7步：记录结果并生成轮次报告

**目标**: 记录本轮分析结果，生成结构化的轮次报告

**输入**: 量化评估、测试结果、分析过程
**输出**: 轮次分析报告、关键发现文档、分析质量评价

**操作清单**:

- [ ] **整理轮次分析文档**: 汇总本轮完整的分析过程和结果
- [ ] **生成核心输出文档**: 在 `summary/` 目录创建以下核心文档：
  - `round_analysis_report.md` - 轮次分析报告（主要输出）
  - `round_key_findings.md` - 轮次关键发现
  - `round_summary.md` - 轮次总结记录
- [ ] **生成详细分析报告**: 在 `reports/` 目录创建专项分析报告
- [ ] **保存量化数据**: 在 `metrics/` 目录保存代码指标和评估数据
- [ ] **归档分析过程**: 在 `analysis/` 目录保存分析笔记和中间结果
- [ ] **评价分析质量**: 评价本轮分析的完整性和准确性
- [ ] **识别分析限制**: 记录分析过程中的限制和不足
- [ ] **提取可复用经验**: 记录需要在下轮改进的分析方法
- [ ] **更新总体进展**: 评估本轮对总体目标的贡献度

### 💡 第8步：生成轮次改进建议与经验总结

**目标**: 基于本轮分析结果提出具体的改进建议，并总结分析经验

**输入**: 轮次分析结果、质量评价
**输出**: 轮次改进建议文档、经验总结文档

**操作清单**:

- [ ] **识别轮次改进点**: 基于本轮分析识别具体改进点
- [ ] **提出针对性建议**: 提出本轮重点关注领域的改进建议
- [ ] **评估建议可行性**: 对建议进行影响程度和实施难度评估
- [ ] **生成核心建议文档**: 在 `summary/` 目录创建：
  - `round_recommendations.md` - 轮次改进建议
  - `round_lessons_learned.md` - 轮次经验总结（使用模板：`templates/lessons-learned-template.md`）
- [ ] **标记建议优先级**: 对建议进行优先级分类（高/中/低）
- [ ] **关联总体目标**: 说明建议与总体分析目标的关系
- [ ] **总结分析经验**: 记录本轮分析过程中的经验教训和最佳实践
- [ ] **识别改进机会**: 记录分析方法、工具使用、流程优化等方面的改进点

### 🚀 第9步：轮次归档与总体进展评估

**目标**: 完成本轮归档并评估总体分析进展

**输入**: 轮次改进建议、项目约束条件、总体分析计划
**输出**: 轮次归档结果、总体进展评估、循环决策

**操作清单**:

- [ ] **完成轮次归档**: 确保所有核心文档已保存到 `summary/` 目录
- [ ] **整理详细资料**: 确保分析过程文档妥善归档到对应子目录
- [ ] **评估总体进展**: 对照总体计划评估当前完成度
- [ ] **分析剩余任务**: 识别总体计划中尚未完成的任务
- [ ] **评估继续价值**: 评估继续分析的成本效益比
- [ ] **更新总体计划**: 根据新发现调整总体分析计划（如需要）
- [ ] **生成进展报告**: 创建总体进展评估文档
- [ ] **循环决策判断**: 决定是否继续下轮分析或进入汇总阶段

**🗂️ 轮次归档指导**:

- **📋 summary/** - 核心输出文档（必需）
  - 轮次分析计划、报告、发现、建议、经验总结
  - 轮次总结记录
  - 这些是轮次的核心成果，必须完整保存

- **📄 reports/** - 详细分析报告（重要）
  - 各专项分析的详细报告
  - 深度分析结果和技术细节
  - 为核心发现提供支撑证据

- **📈 metrics/** - 量化数据（重要）
  - 代码指标和评估数据
  - 性能基准和测试结果
  - 质量评分和趋势数据

- **🔍 analysis/** - 分析过程（参考）
  - 分析工作笔记和中间结果
  - 问题排查过程记录
  - 测试代码和验证脚本
  - 可选保留的临时文件

**循环判断和用户决策**:

**进展总结**:

- 本轮主要成果: [列出关键成果]
- 目标达成度: [评估完成百分比]
- 关键发现: [重要发现总结]

**遗留问题评估**:

- 高优先级问题: [需要紧急处理的问题]
- 中优先级问题: [可以考虑进一步分析的问题]  
- 低优先级问题: [暂时可以忽略的问题]

**暂停点**: 必须暂停并询问用户意见

**用户决策提示**: 使用模板 `templates/user-decision-template.md` 收集用户决策

**循环决策结果**:

- **继续下一轮**: 仍有重要问题未解决，且有进一步分析价值
  - 创建下一轮分析环境
  - 制定下轮分析计划
- **深化当前问题**: 需要对特定问题进行更深入分析
  - 调整当前轮次分析范围
  - 重新执行部分分析步骤
- **准备结束**: 已获得足够信息制定改进计划
  - 进入阶段三汇总报告流程
- **征询更多信息**: 让用户提供更多背景或澄清需求
  - 暂停当前分析
  - 收集额外信息后决定是否继续

---

## 💡 分析原则

### 🔑 核心原则

1. **系统化**: 全面覆盖代码质量的各个维度，建立完整分析体系
2. **可量化**: 所有分析结果都基于可测量的客观数据
3. **可操作**: 提供具体可执行的改进建议，明确实施路径
4. **持续性**: 建立可重复的分析流程，支持长期质量改进

#### 🎯 实战核心原则（基于实际经验）

**6. 分层分析法**:

- **基础数据收集** → **结构分析** → **职责识别** → **风险评估**
- 从宏观到微观，逐步深入，每层都有明确输出目标
- 避免一次性深入，保持分析节奏可控

**7. 风险驱动优先级**:

- **低风险高收益** → **中风险高收益** → **高风险任意收益**
- 优先处理纯函数和独立模块
- 谨慎处理性能关键和状态管理代码

**8. 小步快跑策略**:

- 小步骤、可验证、可回滚的改进策略
- 每步都确保功能完整性，避免大规模重构风险
- 建立快速反馈循环，及时调整分析方向

**9. 渐进式重构原则**:

- 按职责拆分：配置、数据、计算、状态分离
- 按风险分级：先处理低风险独立模块  
- 按依赖关系：优先处理被依赖少的模块

**10. 优先级排序法**:

- 基于影响程度和实施难度的二维评估
- 优先处理高影响低难度的改进点
- 明确标注不可拆分的核心业务逻辑

### 📊 质量维度

#### 🏗️ 基础质量维度

- **结构质量**: 模块化、耦合度、内聚性、方法大小与复杂度
- **代码质量**: 复杂度、可读性、可维护性、职责分离
- **性能质量**: 算法效率、资源使用、响应时间、数值计算稳定性
- **安全质量**: 安全漏洞、最佳实践、风险评估
- **测试质量**: 覆盖率、测试设计、质量保证

#### 🎯 重构专项质量维度（基于实际经验）

- **重构质量**: 拆分可行性、接口稳定性、风险可控性
- **模块独立性**: 模块间耦合度、依赖复杂度、拆分边界清晰度
- **业务逻辑完整性**: 核心算法不可拆分性、业务流程连贯性
- **接口设计质量**: 接口兼容性、数据传递效率、调用复杂度
- **状态管理质量**: 状态隔离度、数据流向清晰度、并发安全性
- **配置管理质量**: 配置集中度、参数验证完整性、默认值合理性
- **工具方法质量**: 工具函数纯度、复用性、测试覆盖度

### 🎯 分析方法

#### 📊 基础分析方法

- **静态分析**: AST解析、代码扫描、模式识别
- **动态分析**: 性能剖析、运行时监控、行为分析
- **架构分析**: 依赖分析、设计评估、模式识别
- **对比分析**: 版本对比、基准对比、最佳实践对比

#### 🔍 实战分析方法（基于实际经验）

**分层量化分析法**:

- **代码行数统计**: 快速识别大方法和复杂类，建立复杂度基线
- **方法数量分析**: 评估类的职责范围，识别过载类
- **依赖关系映射**: 理解模块间的耦合程度，识别紧耦合点
- **核心热点识别**: 优先处理核心区域，建立优化优先级

**重构可行性分析法**:

- **模块拆分评估**: 评估模块拆分的技术可行性和业务风险
- **接口设计验证**: 验证新接口的稳定性和向后兼容性
- **风险等级划分**: 基于影响范围和复杂度进行风险分级
- **核心逻辑标注**: 识别和标注不可拆分的核心业务循环

**渐进评估方法**:

- **阶段性风险控制**: 每步重构都建立风险评估和控制机制
- **增量验证**: 每次改动都进行功能验证和性能对比

**工具组合应用法**:

- **语义搜索**: 快速理解代码整体结构和模式
- **正则搜索**: 精确查找方法定义、调用关系和特定模式
- **代码阅读**: 深度理解核心业务逻辑和算法实现
- **人工判断**: 评估重构可行性、风险程度和业务影响

---

## 📝 使用示例

### 示例1：项目质量评估

```text
用户描述: "我的音频信号处理系统使用Python+PySide6开发，需要进行全面的代码质量评估。希望重点关注算法复杂度和GUI性能，分析目标是制定重构计划。"

AI解析:
- 项目类型: 音频信号处理系统
- 技术栈: Python + PySide6
- 分析类型: 全面代码质量评估
- 关注重点: 算法复杂度、GUI性能
- 分析目标: 制定重构计划
```

### 示例2：性能优化分析

```text
用户描述: "我的实时数据处理项目在处理大量数据时性能不佳，需要进行性能瓶颈分析。希望识别出具体的性能热点并提供优化建议。"

AI解析:
- 项目类型: 实时数据处理系统
- 问题描述: 大数据量处理性能不佳
- 分析类型: 性能瓶颈分析
- 关注重点: 性能热点识别
- 分析目标: 提供优化建议
```

---

## 📚 附录

### 附录A：工具配置

#### 必需工具

- **Python 3.8+**: 运行分析工具
- **代码指标收集器**: `code-metrics-collector.py`
- **报告生成工具**: `generate-analysis-report.ps1`

#### 可选工具

- **pylint**: 代码质量检查
- **coverage.py**: 测试覆盖率分析
- **cProfile**: 性能剖析
- **mypy**: 类型检查

#### 环境准备

```powershell
# 安装Python依赖
pip install -r requirements.txt

# 验证工具可用性
python tools\code-metrics-collector.py --help
.\tools\generate-analysis-report.ps1 -Help

# 创建分析环境
mkdir analysis_workspace
cd analysis_workspace
```

### 附录B：检查清单

#### 分析前检查

- [ ] 确认项目路径和范围
- [ ] 验证分析工具可用性
- [ ] 准备分析环境和目录
- [ ] 明确分析目标和成功标准

#### 分析过程检查

- [ ] 数据收集完整性
- [ ] 分析方法适用性
- [ ] 结果客观性和准确性
- [ ] 建议可行性和实用性

#### 分析后检查

- [ ] 文档完整性和规范性
- [ ] 结果可重现性
- [ ] 改进建议具体性
- [ ] 存档和版本管理

---

**开始分析**: 遵循标准流程，从用户需求描述开始您的代码分析之旅。

**获取支持**: 查看 `templates/` 目录获取标准模板，参考 `case-studies/` 了解分析案例。
