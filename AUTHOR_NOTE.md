# 作者的话：Copilot 工作流体系的演进与实践

> 本文旨在向首次接触本仓库的用户快速介绍 5 大核心工作流的设计动机、使用定位与真实演进经验，并分享如何开发与迭代属于你自己的 AI 协作工作流。

---

## 🧭 演进时间线（里程碑概览）

| 顺序 | 工作流                                     | 角色定位         | 主要目的               | 当前成熟度 |
| ---- | ------------------------------------------ | ---------------- | ---------------------- | ---------- |
| 1    | 调试工作流 (debug-system)                  | 故障排查中枢     | 固化调试→提升交互效率 | ⭐⭐⭐⭐☆ |
| 2    | 文件整理工作流 (file-organize-system)      | 结构治理辅助     | 结构清理 / 分类规范化  | ⭐⭐☆☆☆ |
| 3    | 分析工作流 (analysis_system)               | 认知建立引擎     | 系统/模块理解与评估    | ⭐⭐⭐⭐☆ |
| 4    | 重构工作流 (refactor_system)               | 渐进式改造执行器 | 模块级安全重构         | ⭐⭐⭐☆☆ |
| 5    | 版本对比工作流 (version-comparison-system) | 发布差异透视镜   | 补全/校准版本变更认知  | ⭐⭐⭐⭐☆ |

成熟度说明：结合规范完整性 / 模板充分度 / 真实使用反馈主观评估。

---

## 🔑 五大核心工作流概述

### 调试工作流 (debug-system)

| 维度 | 内容 |
| ---- | ---- |
| 背景痛点 | 临时化调试跳步、记录分散、复盘困难 |
| 流程结构与特点 | “7步总体” + “6步循环”；`buglist` 分 to_fix/fixed；轮次目录+模板；显式暂停：初始确认 / 轮次结束 / 终局归档；经验萃取与归档索引化 |
| 价值 | 提升收敛速度与可追溯性；防上下文漂移；沉淀复用知识 |
| 核心输出 | Bug 列表、轮次记录、阶段/总结/经验/最终分析报告、归档索引 |
| 边界 | 不自动根因定位；不替代真实运行与测试；不保证一轮解决 |
| 质量控制与约束 | 变更前备份；Bug 迁移补元数据；禁止跳过计划→分析→修正→执行→检查→记录；轮次收束需用户确认下一轮目标 |

### 文件整理工作流 (file-organize-system)

| 维度 | 内容 |
| ---- | ---- |
| 背景痛点 | 目录层级失控、命名不一、重复/冗余、缺回滚验证 |
| 流程结构与特点 | 三模式：标准模板 / 参考目录逆向 / 多轮确认定制；“准备→执行6步→总结”；配套重复检测与完整性校验脚本 |
| 价值 | 降低重构性整理风险；模板化沉淀结构蓝本；保障安全与审计 |
| 核心输出 | 分析报告、整理计划、备份集、执行日志、总结报告、目录模板增量、INDEX 更新 |
| 边界 | 不执行不可逆 destructive；不保证定制结构最优；“智能”仅限统计/扫描 |
| 质量控制与约束 | 多轮“解析→确认”闭环；执行前强制备份；重复处理规则显式；验证通过才归档；模板/规则需用户显式确认 |

### 分析工作流 (analysis_system)

| 维度 | 内容 |
| ---- | ---- |
| 背景痛点 | 初始认知成本高；缺量化基线；决策随意；重构无风险图谱 |
| 流程结构与特点 | 三阶段：规划(1.x)→9步循环→汇总(3.x)；9步含计划/采集/范围/深度/量化/报告/建议/经验/决策；支持多轮递进与重构计划触发 |
| 价值 | 形成质量/风险/指标基线；支持重构优先级与决策证据链 |
| 核心输出 | 总体规划、轮次计划与报告套件、指标数据、最终分析/高层摘要、改进路线图、（可选）重构计划草案、方法论与经验 |
| 边界 | 不直接改代码；不自动生成可用重构方案；指标受数据可得性限制 |
| 质量控制与约束 | 阶段/轮次暂停点；报告需证据引用；轮次目录结构固定；进入汇总需覆盖与闭环条件；禁止跳过 round_plan |

### 重构工作流 (refactor_system)

| 维度 | 内容 |
| ---- | ---- |
| 背景痛点 | 大规模一刀切风险；需求漂移；抽象膨胀；缺回滚链路 |
| 流程结构与特点 | 三层级计划（L1/L2/L3）+ 双循环（阶段 O.1-O.7 / 修改点 I.1-I.6）；支持插入阶段；函数新增需 L2 列表+批准；模板驱动执行与归档 |
| 价值 | 拆解为可验证最小增量；限制机会式扩散；沉淀阶段与修改点经验；保障渐进安全 |
| 核心输出 | 总体/阶段/修改点计划、实施日志、修改点结果、阶段总结、经验文档、测试与验证记录、交付报告、版本标签与归档索引 |
| 边界 | 不支持无计划批量改；不自动生成未确认抽象；不替代完整测试；不承诺“一阶段全覆盖” |
| 质量控制与约束 | L2 计划与新增函数清单需确认；L3 禁止超范围；修改点质量验证；计划变更版本化；阶段结束需验证→总结→提交→标签；备份/归档命名规范强制 |

### 版本对比工作流 (version-comparison)

| 维度 | 内容 |
| ---- | ---- |
| 背景痛点 | 提交粒度不均致变更遗漏；人工 diff 低效；缺模块风险/兼容视图；切换分支影响安全 |
| 流程结构与特点 | 10步：需求→解析→确认→专用文档→环境初始化→双 worktree→Stage1 总览→Stage2 模块循环→Stage3 文档变更→汇总；模块清单来自 diff + 用户确认；多 Stage 输出分层 |
| 价值 | 快速构建差异事实基线；支持高质量更新日志与升级指引；降低遗漏破坏性变更 |
| 核心输出 | 提交/文件统计、模块影响概览、模块分析报告、文档变更记录、版本对比报告、更新日志草稿、归档索引 |
| 边界 | 不自动定模块优先级；不改业务代码；不保证提交语义质量；worktree 清理需许可 |
| 质量控制与约束 | 模块清单与顺序确认；模块分析模板化；阶段性总结阈值；报告/日志模板化；清理需显式确认；禁止提前删除中间统计文件 |

> 说明：表格为精简表达，详细执行细节以各工作流目录下模板为准。

---

## 🛠 如何开发你自己的工作流（实践建议）

1. 从“线性（顺序）型”开始：早期不要急于设计包含大量分支 / 嵌套循环的复杂流程。
2. 先做“模板容器”，再做“策略规则”：AI 擅长填空，不擅长“无模板即兴严肃组织”。
3. 选一个真实痛点场景反复使用 → 观察“AI 易出错点 / 赘述点 / 遗漏点”，再反向写入模板。
4. 控制模板密度：删掉不会被有效利用的章节；保留“关键决策+标准检查+成果出口”三类块。
5. 引入经验法则（ heuristics ）：
   - 延迟冲动：例如“遇到结构未扫清，不立刻优化实现”。
   - 双重审查：完成后再用“异常扫描清单”过一遍。
   - 节奏锚点：固定时间 / 文件数 / 阶段总结（防上下文漂移）。
6. 逐次内化：把“这次临时提示里效果好的语句”沉淀为模板固定段落。

---

## 📐 模板设计经验（关键要点）

| 关注点     | 反模式          | 改进策略                                             |
| ---------- | --------------- | ---------------------------------------------------- |
| 章节过多   | AI 忽略后半段   | 分级：必填 / 可选 / 扩展；可选标注注释说明           |
| 抽象术语   | AI 生成空洞描述 | 用具体检验维度替换（示例：复杂度、耦合度、接口变化） |
| 指令歧义   | AI 自行发挥     | 用“禁止做 / 必须暂停点”显式声明控制点              |
| 总结缺验证 | 结果口号化      | 强制加入“证据引用 / 文件路径 / diff 依据”          |
| 缺失败处理 | 一遇异常停摆    | 设计“异常兜底块”：降级策略 / 手动介入指引          |

---

## 🧪 让 AI “三思而后行” 的技巧

- 约束结构：明确阶段入口 / 退出条件 / 产出格式。
- 复盘插槽：每轮循环末尾插入“自检：是否遗漏 X / 是否偏离任务目标”。
- 任务冻结：阶段确认后，前序阶段内容仅允许追加“补充区”，禁止整体重写。
- 角色切换：在关键步骤引导 AI 临时“扮演审查者”而非继续生成者。

---

## 🔍 常见问题（FAQ 摘要）

| 问题         | 典型后果              | 建议                               |
| ------------ | --------------------- | ---------------------------------- |
| 模板太理想化 | 执行流于形式          | 用真实一次执行后的产物倒推裁剪     |
| 一次重构过大 | 上下文爆炸 / 计划游移 | 拆分为多轮模块级窗口               |
| 提交粒度混乱 | 更新日志不可回溯      | 结合工作流产物写提交说明草稿       |
| 忽视归档     | 经验难迁移            | 将“归档”列为最后一步且设为强约束 |

---

## 🚀 未来可能方向（展望）

- 自动化版本差异分类增强（语义+结构双通道）
- 变更风险热度图（结合提交频率 + 模块耦合度）
- 模板智能裁剪（根据任务规模自动降维）
- 工作流链式编排（分析→重构→回归验证全链）

---

## 🧾 致读者

这些工作流并不追求“完美一次成型”，而是在真实使用中不断磨合。若你也正被“重复耗时的协作指令”“混乱的分析记录”“难以复盘的重构”困扰，希望这里的结构化方法能提供一个起点。欢迎你基于自身场景继续演化，并把新的经验法则再反向注入模板。

> 如果你打算新增一个工作流：请先写下“1句话目的 + 3个核心机制 + 1个退出标准”，再动手建目录与模板。

---

**最后更新**: 2025-08-13
**作者**: Copilot 工作流体系维护者 & GPT-5 协同
