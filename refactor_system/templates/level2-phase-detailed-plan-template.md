# 🚀 [项目名称]重构 - P[X]阶段详细计划（第二层级）

> **计划制定时间**: [日期]
> **基于成果**: [总体计划文档链接]
> **实施目标**: [阶段主要目标]
> **层级说明**: 单阶段详细计划，包含单个阶段的全部修改点，根据模块数不同可能使用二级编号

## 📋 P[X]阶段总体目标

### 🎯 核心目标

**主要目标**:

- [目标1：具体的代码提取或重构目标]
- [目标2：架构改进目标]
- [目标3：代码量减少目标]
- [目标4：职责边界明确目标]

**成功标准**:

- ✅ [标准1：功能完整性标准]
- ✅ [标准2：代码质量标准]
- ✅ [标准3：性能影响> **渐进式优势**:
>
> - 🔄 不需要一次性确认所有修改，降低决策压力
> - 🎯 每次只处理部分修改，风险可控
> - 📊 可根据前期修改效果调整后续计划
> - 🚀 无需等待全部计划确认，可立即开始核心任务 ✅ [标准4：兼容性标准]

**阶段约束**:

- 🛡️ **功能保护**: [具体需要保护的功能清单]
- ⚡ **性能要求**: [具体性能指标要求]
- 🔄 **可回滚**: [回滚策略和检查点]
- 📊 **验证方式**: [具体验证方法]

## 🏗️ P[X]阶段架构设计

### 📁 当前阶段架构状态

```text
[当前涉及的模块结构和问题描述]
```

### 📁 目标模块结构

```text
[项目根目录]/
├── [主模块].py (主类 - [变化描述])
├── [新模块1].py ([状态] - [功能描述])
├── [新模块2].py ([状态] - [功能描述])
├── [现有模块].py (✅已存在 - 保持)
└── [工具模块].py (扩展 - [功能描述])
```

### 🔄 数据流设计

```text
主流程：
[主类] (编排器)
    ↓ [步骤1]
[模块1] ([职责描述])
    ├─ [子功能1] ([详细说明])
    ├─ [子功能2] ([详细说明])  
    └─ [子功能3] ([详细说明])
    ↓ [步骤2]
[模块2] ([职责描述])
    ↓ [步骤3]
[执行结果]
```

## 📅 P[X]阶段具体修改点

### 🎯 P[X].1 修改主题1：[具体修改主题名称]

**修改范围**: [涉及的文件和模块]
**修改类型**: [新建/重构/迁移/删除]
**预计工作量**: [时间估算]
**风险等级**: 🔴高/🟡中/🟢低

**涉及模块列表**:

- **模块1**: [文件名] - [修改内容概述]
- **模块2**: [文件名] - [修改内容概述]
- **模块3**: [文件名] - [修改内容概述]

**函数变更清单**:

> **说明**: 此清单列出本修改点的所有函数变更，请用户审核后告知AI哪些要执行或在"用户决策"列中填写：✅执行 / ⏸️暂缓 / ❌跳过

#### 📝 [新模块名].py 函数变更清单

**类名**: `[ClassName]`

| 变更类型 | 函数名             | 功能描述/修改说明          | 参数说明         | 返回值     | 影响评估 | 必要性评估 | 用户决策 |
| -------- | ------------------ | -------------------------- | ---------------- | ---------- | -------- | ---------- | -------- |
| ➕新增   | `__init__`       | 初始化[类功能]             | config, logger   | None       | 🟢低影响 | ✅必要     | [ ]      |
| ➕新增   | `[method1_name]` | [具体功能描述]             | [参数类型和说明] | [返回类型] | 🟡中影响 | 🟡待确认   | [ ]      |
| ➕新增   | `[method2_name]` | [具体功能描述]             | [参数类型和说明] | [返回类型] | 🟢低影响 | 🟡待确认   | [ ]      |
| ➕新增   | `[method3_name]` | [具体功能描述]             | [参数类型和说明] | [返回类型] | 🟢低影响 | ❓可选     | [ ]      |

**独立函数**:

| 变更类型 | 函数名               | 功能描述/修改说明   | 参数说明         | 返回值     | 影响评估 | 必要性评估 | 用户决策 |
| -------- | -------------------- | ------------------- | ---------------- | ---------- | -------- | ---------- | -------- |
| ➕新增   | `[function1_name]` | [具体功能描述]      | [参数类型和说明] | [返回类型] | 🟡中影响 | 🟡待确认   | [ ]      |
| ➕新增   | `[function2_name]` | [具体功能描述]      | [参数类型和说明] | [返回类型] | 🟢低影响 | ❓可选     | [ ]      |

#### 📝 [主模块名].py 函数变更清单

| 变更类型 | 函数名                   | 功能描述/修改说明                    | 参数说明         | 返回值     | 影响评估 | 必要性评估 | 用户决策 |
| -------- | ------------------------ | ------------------------------------ | ---------------- | ---------- | -------- | ---------- | -------- |
| 🔄修改   | `[existing_method1]`   | 简化：移除[具体逻辑]，调用新模块     | [原有参数]       | [原返回值] | 🟢低影响 | ✅必要     | [ ]      |
| 🔄修改   | `[existing_method2]`   | 重构：[具体修改内容]                 | [修改后参数]     | [修改返回] | 🟡中影响 | 🟡待确认   | [ ]      |
| ➕新增   | `[new_method_name]`    | [具体功能描述]                       | [参数类型和说明] | [返回类型] | 🟡中影响 | 🟡待确认   | [ ]      |
| 🗑️移除   | `[old_method1]`        | 移除原因：功能重复/不再需要，已由[新模块]替代 | -              | -          | 🟢低影响 | ✅必要     | [ ]      |
| 🗑️移除   | `[old_method2]`        | 移除原因：代码过时/冗余，合并到[其他方法] | -              | -          | 🟡中影响 | 🟡待确认   | [ ]      |
| 🗑️移除   | `[deprecated_method]` | 移除原因：性能问题/设计缺陷，重新设计为[新方法] | -              | -          | 🔴高影响 | 🟡待确认   | [ ]      |

**预期成果**:

- [成果1：具体可验证的成果]
- [成果2：具体可验证的成果]
- [成果3：具体可验证的成果]

**技术依赖**: [依赖的其他修改点或外部条件]

### 🎯 P[X].2 修改主题2：[具体修改主题名称]

**修改范围**: [涉及的文件和模块]
**修改类型**: [新建/重构/迁移/删除]
**预计工作量**: [时间估算]
**风险等级**: 🔴高/🟡中/🟢低

**涉及模块列表**:

- **模块1**: [文件名] - [修改内容概述]
- **模块2**: [文件名] - [修改内容概述]

**函数变更清单**:

> **说明**: 此清单列出本修改点的所有函数变更，请用户审核后告知AI哪些要执行或在"用户决策"列中填写：✅执行 / ⏸️暂缓 / ❌跳过

#### 📝 [模块名2].py 函数变更清单

**类名**: `[ClassName]`

| 变更类型 | 函数名             | 功能描述/修改说明   | 参数说明         | 返回值     | 影响评估 | 必要性评估 | 用户决策 |
| -------- | ------------------ | ------------------- | ---------------- | ---------- | -------- | ---------- | -------- |
| ➕新增   | `[method1_name]` | [具体功能描述]      | [参数类型和说明] | [返回类型] | 🟡中影响 | 🟡待确认   | [ ]      |
| ➕新增   | `[method2_name]` | [具体功能描述]      | [参数类型和说明] | [返回类型] | 🟢低影响 | ❓可选     | [ ]      |
| 🔄修改   | `[existing_method]` | 优化：[具体修改内容描述] | [参数说明]   | [返回值]   | 🟢低影响 | 🟡待确认   | [ ]      |
| 🗑️移除   | `[old_function]`   | 移除原因：[移除原因描述]，替代方案：[替代方案描述] | -              | -          | 🟡中影响 | 🟡待确认   | [ ]      |

**预期成果**:

- [成果1：具体可验证的成果]
- [成果2：具体可验证的成果]

**技术依赖**: [依赖的其他修改点或外部条件]

### 🎯 P[X].3 修改主题3：[具体修改主题名称]

**修改范围**: [涉及的文件和模块]
**修改类型**: [新建/重构/迁移/删除]
**预计工作量**: [时间估算]
**风险等级**: 🔴高/🟡中/🟢低

**涉及模块列表**:

- **模块1**: [文件名] - [修改内容概述]

**函数变更清单**:

> **说明**: 此清单列出本修改点的所有函数变更，请用户审核后告知AI哪些要执行或在"用户决策"列中填写：✅执行 / ⏸️暂缓 / ❌跳过

#### 📝 [模块名3].py 函数变更清单

**独立函数**:

| 变更类型 | 函数名                    | 功能描述/修改说明                    | 参数说明         | 返回值     | 影响评估 | 必要性评估 | 用户决策 |
| -------- | ------------------------- | ------------------------------------ | ---------------- | ---------- | -------- | ---------- | -------- |
| ➕新增   | `[function1_name]`      | [具体功能描述]                       | [参数类型和说明] | [返回类型] | 🟡中影响 | 🟡待确认   | [ ]      |
| ➕新增   | `[function2_name]`      | [具体功能描述]                       | [参数类型和说明] | [返回类型] | 🟢低影响 | ❓可选     | [ ]      |
| 🗑️移除   | `[obsolete_function]`   | 移除原因：[移除原因描述]，替代方案：[替代方案描述] | -              | -          | 🟢低影响 | ✅必要     | [ ]      |

**预期成果**:

- [成果1：具体可验证的成果]
- [成果2：具体可验证的成果]

**技术依赖**: [依赖的其他修改点或外部条件]

## 🤝 用户确认检查点

> **⚠️ 重要提醒**: 本阶段计划制定完成后，**等待用户选择下一批执行任务**！可以有效避免过度设计和代码膨胀的问题
>
> **渐进式工作流程**：
>
> 1. **用户选择任务**: "接下来先执行P1.1，其中method1和method3要做，method2跳过"
> 2. **AI制定详细计划**: 为选定任务制定第三层级具体实施计划
> 3. **AI执行代码修改**: 完成选定的函数变更
> 4. **回到第二层级**: 完成后回到本文档，用户继续选择下一批任务
>
> **渐进式优势**:
>
> - 🔄 **逐步推进**: 不需要一次性确认所有修改，降低决策压力
> - 🎯 **风险可控**: 每次只处理部分修改，便于测试和回滚
> - 📊 **反馈及时**: 可以根据前期修改效果调整后续计划
> - 🚀 **快速启动**: 无需等待全部计划确认，可以立即开始核心任务

### 🎯 渐进式任务选择指南

**用户只需告知接下来要执行的任务**：

- 🎯 **任务选择**: "接下来先执行P[X].1，优先级高"
- 📝 **函数选择**: "其中method1和method3要做，method2跳过"
- 🚀 **启动指令**: "请制定详细计划并开始执行"

**常用指令模板**：

```text
接下来先执行P1.1，其中：
- 新增：method1, method3 (执行)
- 修改：existing_method1 (执行)
- 移除：old_method1 (执行)，old_method2 (跳过)
请制定详细计划并开始执行。
```

**选择原则**：

- 🎯 **优先核心功能**: 先处理核心业务逻辑相关的修改
- 🟢 **低风险优先**: 优先选择影响评估为"低影响"的变更
- 🔗 **考虑依赖关系**: 注意修改点之间的技术依赖
- 📊 **便于验证**: 选择容易测试和验证的修改组合

### 📋 任务执行记录

**已完成的修改点**：

- [ ] P[X].1 [修改主题1] - 状态：[未开始/进行中/已完成] - 完成时间：[日期]
- [ ] P[X].2 [修改主题2] - 状态：[未开始/进行中/已完成] - 完成时间：[日期]  
- [ ] P[X].3 [修改主题3] - 状态：[未开始/进行中/已完成] - 完成时间：[日期]

**当前选择的任务**：

> **用户最近指令**: [用户最新的任务选择指令]
>
> **执行状态**: [计划制定中/代码修改中/测试验证中/已完成]
>
> **相关文档**: [第三层级计划文档链接]

### 🚀 第三层级计划制定指令

**渐进式工作流程**：

> 1. **用户选择任务** → 2. **AI制定详细计划** → 3. **AI执行修改** → 4. **回到第二层级**

**用户指令示例**：

```text
接下来先执行P1.1，其中method1和method3要做，method2跳过，请制定详细计划并开始执行。
```

**AI工作流程**：

1. **制定第三层级计划**: 为选定任务创建具体实施计划
2. **用户确认计划**: 用户确认第三层级计划的技术细节
3. **执行代码修改**: AI按计划执行代码变更
4. **验证和测试**: 完成修改后进行验证
5. **回到第二层级**: 更新任务状态，等待用户选择下一批任务

**循环工作模式**：

- 🔄 **持续迭代**: 完成一批任务后，回到第二层级继续选择
- 📊 **状态跟踪**: 在"任务执行记录"中更新完成状态
- 🎯 **灵活调整**: 可根据前期效果调整后续任务优先级

## 📊 阶段影响评估

### 📈 预期收益

- **代码改进**: [具体指标]
- **架构优化**: [具体改进]
- **维护性**: [具体提升]
- **功能完整性**: [保持现状]

### ⚠️ 风险点分析

- **高风险**: [具体风险和缓解措施]
- **中风险**: [具体风险和缓解措施]
- **低风险**: [具体风险和缓解措施]

### 🔄 回滚策略

- **回滚触发条件**: [具体条件描述]
- **回滚操作步骤**: [具体操作清单]
- **数据恢复**: [数据备份和恢复方案]

## 🚀 实施准备

### 📋 前置条件

- [前置条件1：环境准备]
- [前置条件2：依赖检查]
- [前置条件3：备份完成]

### 🔧 工具准备

- [工具1：测试工具]
- [工具2：验证工具]
- [工具3：监控工具]

### 📊 验证标准

- [验证1：功能验证方法]
- [验证2：性能验证方法]
- [验证3：质量验证方法]

---

## 📝 使用说明

> **重要**: 本文档为第二层级阶段详细计划，采用**渐进式工作流程**
>
> **工作模式**:
>
> 1. **制定完整计划**: 列出阶段内所有修改点和函数变更
> 2. **渐进式执行**: 用户选择部分任务 → AI执行 → 回到计划继续选择
> 3. **状态跟踪**: 在"任务执行记录"中更新已完成的修改点
>
> **表格结构**: 使用统一的"函数变更清单"表格，通过"变更类型"列区分：
>
> - ➕新增：完全新建的函数或方法
> - 🔄修改：对现有函数的修改、重构或优化  
> - 🗑️移除：需要删除的废弃或重复函数
> - 🔀迁移：从一个模块移动到另一个模块的函数
>
> **用户操作**: 选择下一批要执行的任务
>
> - 告知AI要执行哪个修改点（如：P1.1）
> - 指定哪些函数变更要做，哪些跳过
> - AI制定详细计划并执行，完成后回到本文档
>
> **渐进式优势**:
>
> - 🔄 不需要一次性确认所有修改，降低决策压力
> - 🎯 每次只处理部分修改，风险可控
> - � 可根据前期修改效果调整后续计划
> - � 无需等待全部计划确认，可立即开始核心任务
>
> **示例流程**:
>
> ```text
> 用户: "接下来先执行P1.1，method1和method3要做，method2跳过"
> AI: 制定P1.1的详细实施计划并执行代码修改
> 用户: "好的，继续执行P1.2，只做新增函数，修改函数跳过"
> AI: 制定P1.2的详细实施计划并执行代码修改
> 用户: "现在执行P1.3..."
> ```
>
> **下一步**: 用户选择要执行的修改点，AI制定第三层级具体实施计划
>
> **模板参考**: `level3-implementation-plan-template.md`
